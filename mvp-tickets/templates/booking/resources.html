{% extends "base.html" %}
{% block title %}Recursos{% endblock %}
{% block content %}
<h1 class="text-xl font-bold mb-4">Recursos</h1>
<form id="form-recurso" class="space-y-2 mb-4">
  <label>Nombre <input type="text" id="name" class="border p-1" /></label>
  <label>Tipo
    <select id="type" class="border p-1">
      <option value="room">Sala</option>
      <option value="device">Equipo</option>
      <option value="other">Otro</option>
    </select>
  </label>
  <label>Capacidad <input type="number" id="capacity" value="1" class="border p-1" /></label>
  <button type="submit" class="btn bg-blue-500 text-white px-2 py-1">Crear</button>
</form>
<div id="recurso-msg" class="mb-4 text-sm"></div>
<ul id="lista-recursos" class="list-disc pl-5"></ul>

<script>
function getCSRFToken() {
  const name = 'csrftoken=';
  const cookie = document.cookie.split('; ').find(row => row.startsWith(name));
  return cookie ? cookie.split('=')[1] : '';
}

async function cargarRecursos() {
  const resp = await fetch('/api/booking/resources/');
  const data = await resp.json();
  const ul = document.getElementById('lista-recursos');
  ul.innerHTML = '';
  data.forEach(r => {
    const li = document.createElement('li');
    li.textContent = `${r.name} (${r.type})`;
    ul.appendChild(li);
  });
}

document.getElementById('form-recurso').addEventListener('submit', async (e) => {
  e.preventDefault();
  const payload = {
    name: document.getElementById('name').value,
    type: document.getElementById('type').value,
    capacity: parseInt(document.getElementById('capacity').value || '1'),
  };
  const resp = await fetch('/api/booking/resources/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCSRFToken() },
    credentials: 'same-origin',
    body: JSON.stringify(payload),
  });
  const msg = document.getElementById('recurso-msg');
  if (resp.ok) {
    msg.textContent = 'Recurso creado.';
    cargarRecursos();
  } else {
    msg.textContent = 'Error inesperado (c√≥digo ' + resp.status + ')';
  }
});

cargarRecursos();
</script>
{% endblock %}

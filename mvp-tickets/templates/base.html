{% load static %}
{% load roles notifications %} {# filtros personalizados #}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Helpdesk{% endblock %}</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@2.0.3"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />

  <style>
    :root {
      color-scheme: light;
    }
    .btn {
      transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
    }
    .btn:active {
      transform: scale(0.98);
    }
    .brand-title {
      letter-spacing: -0.02em;
    }
    .brand-pill {
      border-radius: 9999px;
      padding: 0.15rem 0.75rem;
      background: rgba(255, 255, 255, 0.15);
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.35em;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }
    .nav-admin summary::-webkit-details-marker {
      display: none;
    }
    .nav-admin__toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      border-radius: 9999px;
      padding: 0.5rem 0.85rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.25em;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.15);
      transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
    }
    .nav-admin__toggle:hover {
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.12);
    }
    .nav-admin[open] .nav-admin__toggle {
      background: rgba(255, 255, 255, 0.35);
    }
    .nav-admin__menu {
      z-index: 60;
      min-width: 14rem;
      border-radius: 1.25rem;
      overflow: hidden;
      backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 24px 45px rgba(30, 64, 175, 0.18);
      border: 1px solid rgba(191, 219, 254, 0.7);
    }
    .nav-admin__menu a {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      padding: 0.75rem 1.1rem;
      font-size: 0.85rem;
      font-weight: 500;
      color: #1f2937;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .nav-admin__menu a:hover {
      background: rgba(59, 130, 246, 0.12);
      color: #1d4ed8;
    }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-gradient-to-r from-indigo-700 via-blue-600 to-sky-500 text-white shadow-lg shadow-indigo-900/20">
    <div class="mx-auto flex w-full max-w-6xl items-center justify-between px-4 py-4">
      <div class="flex items-center gap-10">
        <a href="{% url 'dashboard' %}" class="group flex items-center gap-3 text-2xl font-semibold leading-none brand-title">
          <span class="brand-pill">
            <i class="bi bi-bezier"></i>
            Coyahue
          </span>
          <span class="inline-flex items-center gap-1 rounded-full bg-white/20 px-3 py-1 text-sm font-semibold uppercase tracking-[0.35em] text-white/90">Helpdesk</span>
        </a>
        {% if request.user.is_authenticated %}
        {% with current_path=request.path %}
        <nav class="hidden md:flex items-center gap-2 text-sm">
          <a href="{% url 'tickets_home' %}"
             class="inline-flex items-center gap-2 rounded-full px-4 py-2 font-medium transition {% if current_path|slice:':8' == '/tickets' %}bg-white/20 text-white shadow{% else %}text-white/80 hover:bg-white/15 hover:text-white{% endif %}"
             aria-current="{% if current_path|slice:':8' == '/tickets' %}page{% endif %}">
            <i class="bi bi-ticket"></i> Tickets
          </a>
          <a href="{% url 'reports_dashboard' %}"
             class="inline-flex items-center gap-2 rounded-full px-4 py-2 font-medium transition {% if current_path|slice:':8' == '/reports' %}bg-white/20 text-white shadow{% else %}text-white/80 hover:bg-white/15 hover:text-white{% endif %}"
             aria-current="{% if current_path|slice:':8' == '/reports' %}page{% endif %}">
            <i class="bi bi-clipboard-data"></i> Reportes
          </a>
          <a href="{% url 'dashboard' %}"
             class="inline-flex items-center gap-2 rounded-full px-4 py-2 font-medium transition {% if current_path == '/' %}bg-white/20 text-white shadow{% else %}text-white/80 hover:bg-white/15 hover:text-white{% endif %}"
             aria-current="{% if current_path == '/' %}page{% endif %}">
            <i class="bi bi-grid-1x2"></i> Dashboard
          </a>
          <a href="{% url 'faq_list' %}"
             class="inline-flex items-center gap-2 rounded-full px-4 py-2 font-medium transition {% if current_path|slice:':5' == '/faq/' %}bg-white/20 text-white shadow{% else %}text-white/80 hover:bg-white/15 hover:text-white{% endif %}"
             aria-current="{% if current_path|slice:':5' == '/faq/' %}page{% endif %}">
            <i class="bi bi-question-circle"></i> Preguntas frecuentes
          </a>
        </nav>
        {% endwith %}
        {% endif %}
      </div>

      <div class="flex items-center gap-6 text-sm">
        {% if request.user.is_authenticated %}
          {% if request.user|has_group:"ADMINISTRADOR" or request.user.is_superuser %}
            <details class="nav-admin relative z-40">
              <summary class="nav-admin__toggle">
                <i class="bi bi-sliders"></i>
                Admin Panel
              </summary>
              <div class="nav-admin__menu absolute right-0 mt-3">
                <a href="{% url 'accounts:users_list' %}"><i class="bi bi-people"></i>Usuarios</a>
                <a href="{% url 'accounts:roles_list' %}"><i class="bi bi-person-gear"></i>Roles</a>
                <a href="{% url 'categories_list' %}"><i class="bi bi-diagram-3"></i>Categorías</a>
                <a href="{% url 'priorities_list' %}"><i class="bi bi-lightning"></i>Prioridades</a>
                <a href="{% url 'areas_list' %}"><i class="bi bi-layers"></i>Áreas</a>
                <a href="{% url 'auto_rules_list' %}"><i class="bi bi-magic"></i>Auto-asignación</a>
                <a href="{% url 'logs_list' %}"><i class="bi bi-clipboard-pulse"></i>Logs</a>
              </div>
            </details>
          {% endif %}
          <div class="flex items-center gap-4">
            <a href="{% url 'notifications_list' %}" class="relative hover:text-orange-300 transition-colors">
              <i class="bi bi-bell"></i>
              {% unread_notifications_count as notif_count %}
              {% if notif_count %}
                <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-1">{{ notif_count }}</span>
              {% endif %}
            </a>
            <span>Hola, <span class="font-medium">{{ request.user.username }}</span></span>
            <form action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="hover:text-orange-300 transition-colors">Salir</button>
            </form>
          </div>
        {% else %}
          {% if request.resolver_match.url_name != 'login' %}
          <a href="{% url 'login' %}" class="hover:text-orange-300 transition-colors">Ingresar</a>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </header>


  <main class="mx-auto w-full max-w-6xl px-4 py-6 sm:px-6 lg:px-8">
    {# --- Mensajes flash --- #}
    {% if messages %}
      <div class="space-y-2 mb-4">
        {% for m in messages %}
          <div class="px-3 py-2 rounded text-sm
              {% if m.tags == 'error' %}bg-red-50 text-red-700 border border-red-200
              {% elif m.tags == 'warning' %}bg-yellow-50 text-yellow-700 border border-yellow-200
              {% else %}bg-green-50 text-green-700 border border-green-200{% endif %}">
            {{ m }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>

  {% block body_extra %}{% endblock %}
</body>
</html>


